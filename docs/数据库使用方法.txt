# 本地 SQLite 数据库使用指南

## 📋 概述

本项目使用 SQLite 作为本地数据库，无需安装额外的服务端数据库。SQLite 是一个轻量级、文件型的数据库系统，非常适合本地应用和小型项目。

### 为什么选择 SQLite？

- **无需服务**: 不像 MySQL、PostgreSQL 需要启动服务，SQLite 是文件型数据库
- **轻量级**: 一个 .db 文件就是整个数据库
- **跨平台**: Windows / macOS / Linux 都支持
- **可视化工具成熟**: DB Browser for SQLite 提供图形界面，操作直观

## 🧰 所需工具

### DB Browser for SQLite（免费开源）
- 官网：https://sqlitebrowser.org/
- 支持中文界面（可选）

## 📥 安装步骤

### 第一步：下载并安装 DB Browser for SQLite

1. 打开浏览器，访问 [https://sqlitebrowser.org/dl/](https://sqlitebrowser.org/dl/)
2. 根据你的操作系统下载安装包：
   - Windows：下载 .exe 安装程序
   - macOS：下载 .dmg
   - Linux：有 AppImage、Snap、Flatpak 或通过包管理器安装（如 `sudo apt install sqlitebrowser`）
3. 安装软件（一路默认即可）
   💡 安装完成后，桌面上会出现 "DB Browser for SQLite" 图标。

## 🗂️ 数据库结构

本项目使用 SQLite 数据库存储智能体信息和交互日志，包含以下两个主要表：

### Agents 表（智能体表）
存储用户创建的智能体信息

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INTEGER | 主键，自增 |
| name | TEXT | 智能体名称 |
| service_type | TEXT | 服务类型（JanAI、LM Studio、Ollama） |
| model_name | TEXT | 模型名称 |
| description | TEXT | 智能体描述 |
| config | TEXT | JSON格式的配置信息 |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |

### Logs 表（日志表）
存储用户与智能体的交互日志

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INTEGER | 主键，自增 |
| agent_id | INTEGER | 关联的智能体ID |
| user_input | TEXT | 用户输入 |
| ai_response | TEXT | AI回复 |
| service_type | TEXT | 服务类型 |
| model_name | TEXT | 模型名称 |
| tokens_used | INTEGER | 使用的token数 |
| request_time | TIMESTAMP | 请求时间 |
| response_time | TIMESTAMP | 响应时间 |
| duration | REAL | 响应耗时（秒） |
| status | TEXT | 状态（success/error） |
| error_message | TEXT | 错误信息 |

## 🎯 创建智能体功能

### 在应用中创建智能体

1. 在主界面选择"智能体管理"选项卡
2. 点击"创建智能体"按钮
3. 填写以下信息：
   - 智能体名称：给智能体起一个易记的名字
   - 服务类型：选择 JanAI、LM Studio 或 Ollama
   - 模型名称：选择对应服务中的模型
   - 描述：可选，对智能体功能的简要描述
4. 点击"保存"完成创建

### 在 DB Browser 中手动创建智能体

1. 打开 DB Browser for SQLite
2. 打开项目数据库文件（ai_manager.db）
3. 切换到"浏览数据"标签页
4. 选择"agents"表
5. 点击左下角"新建记录"（绿色+号）
6. 填写智能体信息：
   - name: 智能体名称
   - service_type: 服务类型（JanAI/LM Studio/Ollama）
   - model_name: 模型名称
   - description: 描述（可选）
7. 按回车或点击其他行保存

## 🎯 选择和使用智能体

### 在应用中选择智能体

1. 在主界面选择"聊天"选项卡
2. 从"选择智能体"下拉菜单中选择已创建的智能体
3. 在输入框中输入消息并发送
4. 与智能体进行交互

### 查看智能体信息

1. 在主界面选择"智能体管理"选项卡
2. 查看智能体列表，包含名称、服务类型、模型等信息
3. 可以编辑或删除现有智能体

## 📊 日志功能

### 查看交互日志

1. 在主界面选择"日志"选项卡
2. 查看所有交互记录，按时间倒序排列
3. 可以筛选特定智能体的日志
4. 查看详细信息包括：
   - 用户输入
   - AI回复
   - 使用的模型
   - 响应时间
   - Token使用量

### 在 DB Browser 中查看日志

1. 打开 DB Browser for SQLite
2. 打开项目数据库文件（ai_manager.db）
3. 切换到"浏览数据"标签页
4. 选择"logs"表
5. 查看所有日志记录

### 使用 SQL 查询日志

在 DB Browser 的"执行 SQL"标签页中，可以执行以下查询：

```sql
-- 查询特定智能体的所有日志
SELECT * FROM logs WHERE agent_id = 1;

-- 查询最近的10条日志
SELECT * FROM logs ORDER BY request_time DESC LIMIT 10;

-- 查询包含特定关键词的日志
SELECT * FROM logs WHERE user_input LIKE '%你好%';

-- 统计各智能体的使用次数
SELECT a.name, COUNT(l.id) as usage_count 
FROM agents a 
LEFT JOIN logs l ON a.id = l.agent_id 
GROUP BY a.id;
```

## 📁 数据库存储位置

数据库文件存储在应用程序目录下的 `ai_manager.db` 文件中。

- 双击这个文件，会自动用 DB Browser 打开
- 你可以复制、备份、移动这个文件，整个数据库就跟着走

## ✅ 总结：完整流程回顾

| 步骤 | 操作 |
|------|------|
| 1 | 下载安装 DB Browser for SQLite |
| 2 | 运行应用自动创建数据库文件（.db） |
| 3 | 在应用中创建智能体 |
| 4 | 选择智能体进行对话 |
| 5 | 查看交互日志 |
| 6 | 使用 DB Browser 管理数据 |

## 💡 小贴士

- 应用程序会自动创建和维护数据库结构
- 智能体配置保存在数据库中，重启应用后不会丢失
- 所有交互日志都会自动记录，便于回顾和分析
- 可以使用 DB Browser for SQLite 进行高级数据管理
- 这个方案非常适合个人项目、学习、原型开发、小型应用
- 不适合高并发或多用户同时写入的场景（但单机使用完全没问题）

## 🐍 Python 集成

如果需要使用 Python 直接操作数据库，可以使用内置的 sqlite3 模块：

```python
import sqlite3

# 连接数据库
conn = sqlite3.connect('ai_manager.db')
cursor = conn.cursor()

# 查询数据
cursor.execute("SELECT * FROM agents")
agents = cursor.fetchall()

# 关闭连接
conn.close()
```

如需更多帮助或有其他问题，请随时联系开发团队。